(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{1:function(t,e,i){var s=i(2);"string"==typeof s&&(s=[[t.i,s,""]]);var n={hmr:!0,transform:void 0,insertInto:void 0};i(4)(s,n);s.locals&&(t.exports=s.locals)},2:function(t,e,i){(t.exports=i(3)(!1)).push([t.i,".chess{\n  background-color: #fff;\n  border: 1px solid #000;\n}\n\n#geme-info{\n  text-align: center;\n  margin-bottom: 100px;\n}",""])},8:function(t,e,i){"use strict";i.r(e);var s={};i.r(s),i.d(s,"General",function(){return c}),i.d(s,"Guard",function(){return d}),i.d(s,"Bishop",function(){return f}),i.d(s,"Knight",function(){return v}),i.d(s,"Rook",function(){return u}),i.d(s,"Cannon",function(){return p}),i.d(s,"Pawn",function(){return C});i(1);var n=i(0),r=i.n(n);const o={BoardConfig:{interval:40,offset:{x:40,y:40}},Color:{RED:1,BLACK:0},ChessName:["将","士","象","车","马","炮","卒","帅","仕","相","车","马","炮","兵"],roles:["General","Guard","Bishop","Knight","Rook","Cannon","Pawn"],initChesses:[[0,4,0,0],[0,3,1,0],[0,5,2,0],[0,6,3,0],[0,7,4,0],[0,6,5,0],[0,5,6,0],[0,3,7,0],[0,4,8,0],[0,2,1,2],[0,2,7,2],[0,1,0,3],[0,1,2,3],[0,1,4,3],[0,1,6,3],[0,1,8,3],[1,4,0,9],[1,3,1,9],[1,5,2,9],[1,6,3,9],[1,7,4,9],[1,6,5,9],[1,5,6,9],[1,3,7,9],[1,4,8,9],[1,2,1,7],[1,2,7,7],[1,1,0,6],[1,1,2,6],[1,1,4,6],[1,1,6,6],[1,1,8,6]]};class h{constructor(t,e){this.x=t,this.y=e}move(t,e){this.x+=t,this.y+=e}moveTo(t,e){this.x=t,this.y=e}distanceTo(t){let e=this.x-t.x,i=this.y-t.y;return Math.sqrt(Math.pow(e,2)+Math.pow(i,2))}equals(t){return this.x===t.x&&this.y===t.y}toString(){return`(${this.x},${this.y})`}}let a=["black","red"];class l{constructor(t,e,i){this.role=e,this.color=t,this.name=o.ChessName[7-e+7*t],this.radius=o.BoardConfig.interval/2*.9,this.point=i,this.board=null,this.game=null,this.isActive=!1,this.isDefeated=!1}render(t){if(this.isDefeated)return 0;this.board=t;const e=t.interval,i=t.canvas;let s=this.point.x*e,n=this.point.y*e,r=i.getContext("2d");r.save(),r.lineWidth=2,r.strokeStyle="#000",r.fillStyle="rgb(238, 238, 238)",r.beginPath(),r.arc(s,n,this.radius,0,2*Math.PI),r.fill(),r.stroke(),this.isActive&&(r.beginPath(),r.lineWidth=1,r.strokeStyle="red",r.arc(s,n,this.radius+3,0,2*Math.PI),r.stroke()),r.font="22px serif",r.textBaseline="middle",r.fillStyle=a[this.color];let o=r.measureText(this.name);r.translate(s-o.width/2,n),r.fillText(this.name,0,0),r.restore()}distanceTo(t){const e=this.board.interval;let i=this.point.x*e+e,s=this.point.y*e+e;return Math.sqrt(Math.pow(t.x-i,2)+Math.pow(t.y-s,2))}isInChess(t){let e=this.board.interval,i=this.board.offset.x,s=this.board.offset.y,n=this.point.x*e+i,r=this.point.y*e+s;return Math.sqrt(Math.pow(t.x-n,2)+Math.pow(t.y-r,2))<=this.radius}moveTo(t){this.point=t}}class c extends l{canGo(t){let e=t.x-this.point.x,i=t.y-this.point.y,s=this.point.distanceTo(t);if(this.color===o.Color.RED){if(1===s&&t.x>2&&t.x<6&&t.y>6)return!0}else if(1===s&&t.x>2&&t.x<6&&t.y<3)return!0;let n=this.game.findChess(t),r=Math.abs(i);if(7===n.role&&s>1&&0===e){for(let t=1;t<Math.abs(i);t++){let e=new h(this.point.x,this.point.y+i*t/r);if(this.game.findChess(e))return!1}return!0}}}class d extends l{canGo(t){if(this.color===o.Color.RED){if(t.y<7)return!1}else if(t.y>2)return!1;return!(t.x<3||t.x>5)&&(this.point.distanceTo(t)===Math.SQRT2||void 0)}}class f extends l{canGo(t){let e=t.x-this.point.x,i=t.y-this.point.y;if(this.color===o.Color.RED){if(t.y<5)return!1}else if(t.y>4)return!1;let s=new h(this.point.x+e/2,this.point.y+i/2);return!this.game.findChess(s)&&(e*i!=0&&this.point.distanceTo(t)===Math.sqrt(8)||void 0)}}class v extends l{canGo(t){let e=t.x-this.point.x,i=t.y-this.point.y,s=Math.abs(e),n=Math.abs(i);if(e*i!=0||s+n===0)return!1;if(s>0)for(let t=1;t<s;t++){let i=new h(this.point.x+e*t/s,this.point.y);if(this.game.findChess(i))return!1}else for(let t=1;t<n;t++){let e=new h(this.point.x,this.point.y+i*t/n);if(this.game.findChess(e))return!1}return!0}}class u extends l{canGo(t){let e,i,s=t.x-this.point.x,n=t.y-this.point.y;if(s*n==0||this.point.distanceTo(t)!==Math.sqrt(5))return!1;2===Math.abs(s)?(e=this.point.x+s/2,i=this.point.y):(e=this.point.x,i=this.point.y+n/2);let r=new h(e,i);return!this.game.findChess(r)}}class p extends l{canGo(t){let e=t.x-this.point.x,i=t.y-this.point.y,s=Math.abs(e),n=Math.abs(i);if(e*i!=0||s+n===0)return!1;let r=this.game.findChess(t);if(r&&r.color!==this.game.currentColor)if(s>0)for(let t=1;t<s;t++){let i=new h(this.point.x+e*t/s,this.point.y);if(!this.game.findChess(i))return!1}else for(let t=1;t<n;t++){let e=new h(this.point.x,this.point.y+i*t/n);if(!this.game.findChess(e))return!1}else if(s>0)for(let t=1;t<s;t++){let i=new h(this.point.x+e*t/s,this.point.y);if(this.game.findChess(i))return!1}else for(let t=1;t<n;t++){let e=new h(this.point.x,this.point.y+i*t/n);if(this.game.findChess(e))return!1}return!0}}class C extends l{canGo(t){let e=t.x-this.point.x,i=t.y-this.point.y,s=this.point.distanceTo(t);if(this.color===o.Color.RED){if(this.point.y>4&&0===e&&-1===i)return!0;if(this.point.y<=4&&1===s&&(1===e||-1===e||-1===i))return!0}else{if(this.point.y<5&&0===e&&1===i)return!0;if(this.point.y>=5&&1===s&&(1===e||-1===e||1===i))return!0}}}function x(t,e){let i=function(t){return document.getElementById(t)}(e).getBoundingClientRect(),[s,n]=[i.left,i.top],{x:r,y:o}={x:t.clientX-s,y:t.clientY-n};return{x:r,y:o}}class y{constructor(t,{interval:e=o.BoardConfig.interval,offset:i=o.BoardConfig.offset}={}){this.id=t,this.interval=e,this.offset=i,this.canvas=document.getElementById(this.id)}renderCompatibility(t){let e=t.canvas.width,i=t.canvas.height;window.devicePixelRatio&&(t.canvas.style.width=e+"px",t.canvas.style.height=i+"px",t.canvas.width=e*window.devicePixelRatio,t.canvas.height=i*window.devicePixelRatio,t.scale(window.devicePixelRatio,window.devicePixelRatio))}render(){let t=this.canvas.getContext("2d");this.renderCompatibility(t),t.translate(this.offset.x,this.offset.y);for(let e=0;e<9;e++)if(4!==e)for(let i=0;i<8;i++)t.strokeRect(i*this.interval,e*this.interval,this.interval,this.interval);t.save(),t.beginPath(),t.strokeRect(0,0,8*this.interval,9*this.interval),t.restore();let e=this.interval/10,i=this.interval/3;[[1,2],[7,2],[2,3],[4,3],[6,3],[1,7],[7,7],[2,6],[4,6],[6,6],[8,3],[8,6]].forEach(s=>{t.save(),t.translate(s[0]*this.interval,s[1]*this.interval),t.lineJoin="round";for(let s=0;s<2;s++)t.save(),t.rotate(Math.PI/2*s+Math.PI/2),t.beginPath(),t.moveTo(e,i),t.lineTo(e,e),t.lineTo(i,e),t.stroke(),t.restore();t.restore()}),[[1,2],[7,2],[2,3],[4,3],[6,3],[1,7],[7,7],[2,6],[4,6],[6,6],[0,3],[0,6]].forEach(s=>{t.save(),t.translate(s[0]*this.interval,s[1]*this.interval),t.lineJoin="round";for(let s=0;s<2;s++)t.save(),t.rotate(Math.PI/2*s-Math.PI/2),t.beginPath(),t.moveTo(e,i),t.lineTo(e,e),t.lineTo(i,e),t.stroke(),t.restore();t.restore()}),t.beginPath(),t.moveTo(3*this.interval,0*this.interval),t.lineTo(5*this.interval,2*this.interval),t.moveTo(5*this.interval,0*this.interval),t.lineTo(3*this.interval,2*this.interval),t.moveTo(3*this.interval,9*this.interval),t.lineTo(5*this.interval,7*this.interval),t.moveTo(5*this.interval,9*this.interval),t.lineTo(3*this.interval,7*this.interval),t.stroke(),t.font="20px 微软雅黑 serif",t.textBaseline="top",t.fillStyle="red",t.save(),t.translate(1.5*this.interval,4*this.interval+3*this.interval/4),t.rotate(3*Math.PI/2),t.fillText("楚",0,0),t.restore(),t.save(),t.translate(2.5*this.interval,4*this.interval+3*this.interval/4),t.rotate(3*Math.PI/2),t.fillText("河",0,0),t.restore(),t.save(),t.translate(5.5*this.interval,4*this.interval+1*this.interval/4),t.rotate(Math.PI/2),t.fillText("汉",0,0),t.restore(),t.save(),t.translate(6.5*this.interval,4*this.interval+1*this.interval/4),t.rotate(Math.PI/2),t.fillText("界",0,0),t.restore()}}(new class{constructor(t="chess"){let e=o.BoardConfig.interval,i=o.BoardConfig.offset;this.id=t,this.width=8*e+2*i.x,this.height=9*e+2*i.y,this.canvas=null,this.board=null,this._chessList=[],this.currentColor=o.Color.BLACK,this.activeChess=null,this.history=[]}get chessList(){return this._chessList.filter(t=>!1===t.isDefeated)}init(){this.canvas=this.createCanvasEle(),this.board=this.createBoard(this.id),this.board.render(),o.initChesses.forEach(t=>{let e=this.createChesses(t);e.game=this,this._chessList.push(e),e.render(this.board)}),this.history.push(r.a.cloneDeep(this._chessList));let t=function(t){let e=x(t,this.id);if(!this.isInBoard(e))return!1;let i=function({x:t,y:e}){let i=o.BoardConfig;t=(t-i.offset.x)/i.interval,e=(e-i.offset.y)/i.interval;let s=Math.round(t),n=Math.round(e),r=Math.abs(t-s),a=Math.abs(e-n);return r<.25&&a<.25?new h(s,n):null}(e),s=this.chessList.find(t=>t.isInChess(e));if(this.activeChess&&(!s||s.color!==this.currentColor)){let t=null;if(s&&s.color!==this.currentColor?t=s.point:i&&(t=i),t&&this.chickValid(t)&&this.activeChess.canGo(t))return this.moveChess(this.activeChess,t),this.moveEnd(),this.update(),this.history.push(r.a.cloneDeep(this._chessList)),this.isGameOver(),!0;console.log("不可行至此处！")}if(s){if(s.color===this.currentColor)return this.setActiveChess(s),this.update(),!0;this.activeChess||console.log(`此时应该是${this.currentColor===o.Color.RED?"红":"黑"}方行棋`)}}.bind(this);this.canvas.addEventListener("click",t),document.getElementById("restart").addEventListener("click",this.restart.bind(this)),document.getElementById("regret").addEventListener("click",this.regret.bind(this))}restart(){this.clearCanvas(),this.board.render(),this._chessList=[],this.currentColor=o.Color.BLACK,this.activeChess=null,o.initChesses.forEach(t=>{let e=this.createChesses(t);e.game=this,this._chessList.push(e),e.render(this.board)})}regret(){console.log("regret"),this.history.length>1?(this.history.pop(),this._chessList=r.a.cloneDeep(this.history[this.history.length-1]),this.switchPlayer(),this.clearCanvas(),this.board.render(),this.chessList.forEach(t=>{t.render(this.board)})):console.log("已是初始状态")}createCanvasEle(){let t=document.createElement("canvas");return t.id=this.id,t.width=this.width,t.height=this.height,document.body.appendChild(t),t}clearCanvas(){let t=this.board.offset,e=this.canvas.getContext("2d");e.translate(-t.x,-t.y),e.clearRect(0,0,this.width,this.height)}createBoard(t){return new y(t)}createChesses(t){let e=o.roles[7-t[1]],i=new h(t[2],t[3]),[n,r]=[t[0],t[1]];return new s[e](n,r,i)}setActiveChess(t){this.activeChess&&(this.activeChess.isActive=!1),t.isActive=!0,this.activeChess=t}moveChess(t,e){let i=this.chessList.find(t=>t.point.equals(e));i?i.color!==this.currentColor&&(i.isDefeated=!0,t.moveTo(e)):t.moveTo(e)}update(){this.clearCanvas(),this.board.render(),this.chessList.forEach(t=>{t.render(this.board)})}moveEnd(){this.activeChess.isActive=!1,this.activeChess=null,this.switchPlayer()}switchPlayer(){let t;this.currentColor===o.Color.RED?(this.currentColor=o.Color.BLACK,t="黑"):(this.currentColor=o.Color.RED,t="红"),this.showMsg(`${t}方行棋！`)}chickValid(t){let e=this.chessList.find(e=>e.point.equals(t));return!e||e.color!==this.currentColor}findChess(t){return this.chessList.find(e=>e.point.equals(t))||!1}isInBoard(t){let e=!0,i=2*this.board.offset.x+8*this.board.interval,s=2*this.board.offset.y+9*this.board.interval;return(t.x<0||t.x>i||t.y<0||t.y>s)&&(e=!1),e}isGameOver(){let t=this._chessList.find(t=>7===t.role&&t.isDefeated);if(t){let e=t.color===o.Color.RED?"黑":"红";console.log(`${e}方获得胜利！`),this.showMsg(`${e}方获得胜利！`)}}showMsg(t){document.getElementById("geme-info").innerHTML=t}}).init(),console.log("当前为prod环境!")}},[[8,2,1]]]);